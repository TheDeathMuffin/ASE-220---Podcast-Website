<script src="https://code.jquery.com/jquery-3.6.0.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/popper.js@1.12.9/dist/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>
<script src="preload.js"></script>
<link rel="shortcut icon" type="image/x-icon" href="../icon/icon.ico"/>
<script>
    let params = (new URL(document.location)).searchParams;
    //pulls the jsonblob for the function
    $.getJSON('https://jsonblob.com/api/jsonBlob/953096375785242624', function(data){       //Gathers user data.
        $.getJSON('https://jsonblob.com/api/jsonBlob/953093703074070528', function(data2){  //Gathers podcast data.
            //an array to create a new podcast like list
            newLikedPodcasts = [];
            //loops to like the podcast and indicate it in the array
            for (let i = 0; i < data.length; i++) {              
                if (currentUser == data[i]["email"]) {
                    for (let j = 0; j < data[i]["likedPodcasts"].length; j++) {
                        if (params.get("index") == data[i]["likedPodcasts"][j]) {
                            continue;
                        }
                        newLikedPodcasts.push(data[i]["likedPodcasts"][j]);
                    }
                    data[i]['likedPodcasts'] = newLikedPodcasts;
                }    
            }
            for (let k = 0; k < data2.length; k++) {              
                if (params.get("index") == data2[k]['index']) {              //Loops to find the liked podcast.
                    data2[k]["likes"] = data2[k]["likes"] - 1;               //Decrements like count by 1.
                    if (data2[k]["likes"] < 0) {
                        data2[k]["likes"] = 0;
                    }
                }
            }

            //Updates the podcast's like count.
            myAjax('PUT', 'https://jsonblob.com/api/jsonBlob/953093703074070528', data2, function(){}); 
            //Update the user's liked podcast list.
            myAjax('PUT', 'https://jsonblob.com/api/jsonBlob/953096375785242624', data, function(){
                window.location.href = history.back();
            });
        }); 
    });       
</script>
<script src="postload.js"></script>