<script src="https://code.jquery.com/jquery-3.6.0.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/popper.js@1.12.9/dist/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>
<script src="preload.js"></script>
<link rel="shortcut icon" type="image/x-icon" href="icon/icon.ico"/>
<script>
    let params = (new URL(document.location)).searchParams;
    //pulls the jsonblob for the function
    $.getJSON('https://jsonblob.com/api/jsonBlob/953096375785242624', function(data){       //Gathers user data.
        $.getJSON('https://jsonblob.com/api/jsonBlob/953093703074070528', function(data2){  //Gathers podcast data.
            //an array to create a new podcast save list
            newSavedPodcasts = [];
            //loops to save the podcast and indicate it in the array
            for (let i = 0; i < data.length; i++) {              
                if (currentUser == data[i]["email"]) {
                    for (let j = 0; j < data[i]["savedPodcasts"].length; j++) {
                        if (params.get("index") == data[i]["savedPodcasts"][j]) {
                            continue;
                        }
                        newSavedPodcasts.push(data[i]["savedPodcasts"][j]);
                    }
                    data[i]['savedPodcasts'] = newSavedPodcasts;
                }    
            }
            for (let k = 0; k < data2.length; k++) {              
                if (params.get("index") == data2[k]['index']) {              //Loops to find the saved podcast.
                    data2[k]["saves"] = data2[k]["saves"] - 1;               //Decrements save count by 1.
                    if (data2[k]["saves"] < 0) {
                        data2[k]["saves"] = 0;
                    }
                }
            }

            //Updates the podcast's saves count.
            myAjax('PUT', 'https://jsonblob.com/api/jsonBlob/953093703074070528', data2, function(){
                //window.location.href = "dashboard.html";
            }); 
            //Updates the users saved list.
            myAjax('PUT', 'https://jsonblob.com/api/jsonBlob/953096375785242624', data, function(){
                window.location.href = "index.html";
            });
        }); 
    });       
</script>
<script src="postload.js"></script>