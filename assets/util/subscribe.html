<script src="https://code.jquery.com/jquery-3.6.0.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/popper.js@1.12.9/dist/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>
<script src="../util/preload.js"></script>
<link rel="shortcut icon" type="image/x-icon" href="icon/icon.ico"/>
<script>
    //Checks users email and saves the podcast.
    let params = (new URL(document.location)).searchParams;
    $.getJSON('https://jsonblob.com/api/jsonBlob/953096375785242624', function(data){       //Gathers user data.
        $.getJSON('https://jsonblob.com/api/jsonBlob/953093703074070528', function(data2){  //Gathers podcast data.
            newSubscribedUsers = [];
            for (let i = 0; i < data.length; i++) {                     //Loops for each user.
                if (currentUser == data[i]["email"]) {                  //When the looped user matches the current user, compile their podcasts into an array.
                    for (let j = 0; j < data[i]["subscribedTo"].length; j++) {
                        newSubscribedUsers.push(data[i]["subscribedTo"][j]);
                    }
                    newSubscribedUsers.push(params.get("email"));         //Add the newly-saved podcast to the saved podcast list.
                    data[i]['subscribedTo'] = newSubscribedUsers;
                }
            }
            
            //Updates the podcast's save count.
            myAjax('PUT', 'https://jsonblob.com/api/jsonBlob/953093703074070528', data2, function(){}); 
            //Update the user's saved podcast list.
            myAjax('PUT', 'https://jsonblob.com/api/jsonBlob/953096375785242624', data, function(){
                window.location.href = history.back();
            }); 
        });
    });       
</script>
<script src="../util/postload.js"></script>